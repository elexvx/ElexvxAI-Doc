---
import type { MarkdownHeading } from 'astro';
const { headings = [], docsContent } = Astro.props as { headings?: MarkdownHeading[]; docsContent: any };
const toc: { heading: MarkdownHeading; subheadings: MarkdownHeading[] }[] = [];
headings.forEach((heading) => {
  if (heading.depth === 2) toc.push({ heading, subheadings: [] });
  else if (heading.depth === 3 && toc.length > 0) toc[toc.length - 1].subheadings.push(heading);
});
---

<aside class="docs-toc">
  <div class="toc-sticky-container">
    {toc.length > 0 && (
      <div class="toc-section">
        <h4 class="toc-heading">{docsContent.tocTitle}</h4>
        <ul class="toc-list">
          {toc.map((item) => (
            <li>
              <a href={`#${item.heading.slug}`} class="toc-link">{item.heading.text}</a>
              <ul class="toc-sublist">
                {item.subheadings.map((sub) => <li><a href={`#${sub.slug}`} class="toc-link">{sub.text}</a></li>)}
              </ul>
            </li>
          ))}
        </ul>
      </div>
    )}
    <div class="toc-section"><h4 class="toc-heading">{docsContent.communityTitle}</h4><ul class="community-list">{docsContent.community.map((item: string) => <li>{item}</li>)}</ul></div>
  </div>
</aside>

<style>
.docs-toc{width:220px;padding:20px 10px;position:sticky;top:var(--docs-header-height);height:calc(100vh - var(--docs-header-height));overflow:auto}.toc-list,.toc-sublist,.community-list{list-style:none;padding:0}.toc-link{text-decoration:none;color:var(--docs-text-secondary);display:block;padding:4px 0}@media (max-width:1200px){.docs-toc{display:none}}
</style>
