---
interface NavLink {
  label: string;
  href: string;
}

interface NavContent {
  brand: string;
  ariaLabel: string;
  menuLabel: string;
  links: NavLink[];
  cta: NavLink;
}

const { content } = Astro.props as { content: NavContent };
const pathname = Astro.url.pathname;
---

<nav class="navbar" data-navbar>
  <div class="navbar-shell">
    <a href="/" class="brand-link" aria-label={content.ariaLabel}>{content.brand}</a>

    <button class="mobile-menu-toggle" type="button" aria-label={content.menuLabel} aria-expanded="false" data-mobile-trigger>
      ☰
    </button>

    <div class="navbar-center" aria-label="主导航">
      {content.links.map((link) => (
        <a href={link.href} class:list={["navbar-link", { active: pathname === link.href || pathname.startsWith(`${link.href}/`) && link.href !== '/' }]}>
          {link.label}
        </a>
      ))}
    </div>

    <a href={content.cta.href} class="download-btn">{content.cta.label}</a>
  </div>

  <div class="mobile-panel" data-mobile-panel hidden>
    {content.links.map((link) => (
      <a href={link.href} class="mobile-link">{link.label}</a>
    ))}
    <a href={content.cta.href} class="mobile-download">{content.cta.label}</a>
  </div>
</nav>

<script is:inline>
  document.querySelectorAll('[data-navbar]').forEach((root) => {
    const mobileTrigger = root.querySelector('[data-mobile-trigger]');
    const mobilePanel = root.querySelector('[data-mobile-panel]');

    mobileTrigger?.addEventListener('click', () => {
      const expanded = mobileTrigger.getAttribute('aria-expanded') === 'true';
      mobileTrigger.setAttribute('aria-expanded', String(!expanded));
      if (mobilePanel) mobilePanel.hidden = expanded;
    });
  });
</script>

<style>
  .navbar { position: sticky; top: 0; z-index: 30; backdrop-filter: blur(8px); background: color-mix(in srgb, var(--md-sys-color-background) 86%, transparent); border-bottom: 1px solid var(--md-sys-color-outline-variant); }
  .navbar-shell { max-width: var(--max-width-desktop); margin: 0 auto; padding: 14px var(--padding-horizontal); display: flex; align-items: center; justify-content: space-between; gap: 16px; }
  .brand-link { color: var(--md-sys-color-on-surface); text-decoration: none; font-weight: 700; }
  .navbar-center { display: flex; gap: 8px; }
  .navbar-link { text-decoration: none; color: var(--md-sys-color-on-surface-variant); padding: 8px 12px; border-radius: var(--md-sys-shape-corner-full); }
  .navbar-link.active, .navbar-link:hover { background: var(--md-sys-color-surface-container); color: var(--md-sys-color-on-surface); }
  .download-btn, .mobile-download { text-decoration:none; background: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); padding: 8px 14px; border-radius: var(--md-sys-shape-corner-full); }
  .mobile-menu-toggle { display:none; border:none; background:transparent; color:var(--md-sys-color-on-surface); font-size:20px; }
  .mobile-panel { display:none; padding: 0 var(--padding-horizontal) 16px; }
  .mobile-link { display:block; padding:8px 0; color:var(--md-sys-color-on-surface-variant); text-decoration:none; }
  @media (max-width: 900px) {
    .navbar-center, .download-btn { display:none; }
    .mobile-menu-toggle { display:block; }
    .mobile-panel { display:block; }
  }
</style>
