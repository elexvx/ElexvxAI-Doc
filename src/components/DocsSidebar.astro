---
// src/components/DocsSidebar.astro
import { getCollection } from 'astro:content';

const allDocs = await getCollection('docs');

const docsByCategory = allDocs.reduce((acc, doc) => {
  const category = doc.data.category;
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(doc);
  return acc;
}, {} as Record<string, typeof allDocs>);

const categoryOrder = ["Getting Started", "Core Concepts", "Reference"];
const sortedCategories = Object.keys(docsByCategory).sort((a, b) => {
  const indexA = categoryOrder.indexOf(a);
  const indexB = categoryOrder.indexOf(b);
  if (indexA !== -1 && indexB !== -1) return indexA - indexB;
  if (indexA !== -1) return -1;
  if (indexB !== -1) return 1;
  return a.localeCompare(b);
});

Object.values(docsByCategory).forEach(docs => {
  docs.sort((a, b) => (a.data.order || 0) - (b.data.order || 0));
});

const currentPath = Astro.url.pathname;

function isActive(slug: string) {
  const targetPath = `/docs/${slug}`;
  return currentPath === targetPath || currentPath === `${targetPath}/`;
}

const icons: Record<string, string> = {
  "getting-started/introduction": `<svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20" fill="currentColor"><path d="M160-120v-480l320-240 320 240v480H560v-280H400v280H160Zm80-80h80v-280h320v280h80v-360L480-740 240-480v360Zm240-260Z"/></svg>`,
  "getting-started/installation": `<svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20" fill="currentColor"><path d="M480-320 280-520l56-58 104 104v-326h80v326l104-104 56 58-200 200ZM240-160q-33 0-56.5-23.5T160-240v-120h80v120h480v-120h80v120q0 33-23.5 56.5T720-160H240Z"/></svg>`,
  "core-concepts/neural-networks": `<svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20" fill="currentColor"><path d="m116-248v-289h114v289H116Zm250 0v-464h114v464H366Zm250 0v-200h114v200H616Z"/></svg>`,
};
const defaultIcon = `<svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20" fill="currentColor"><path d="M280-240 80-440l200-200 56 57-143 143 143 143-56 57Zm400 0-56-57 143-143-143-143 56-57 200 200-200 200Z"/></svg>`;

---

<aside class="docs-sidebar">
  <nav class="sidebar-nav">
    
    {sortedCategories.map(category => (
      <div class="nav-section">
        <h3 class="nav-heading">{category}</h3>
        <ul class="nav-list">
          {docsByCategory[category].map(doc => (
            <li>
              <a href={`/docs/${doc.slug}`} class={`nav-item ${isActive(doc.slug) ? 'active' : ''}`}>
                <Fragment set:html={icons[doc.slug] || defaultIcon} />
                {doc.data.title}
              </a>
            </li>
          ))}
        </ul>
      </div>
    ))}

  </nav>
</aside>

<style>
  .docs-sidebar {
    width: var(--docs-sidebar-width);
    flex-shrink: 0;
    height: calc(100vh - var(--docs-header-height));
    position: sticky;
    top: var(--docs-header-height);
    overflow-y: auto;
    background-color: var(--docs-bg-base); /* Using base background per design */
    border-right: 1px solid var(--docs-border-color);
  }

  .sidebar-nav {
    padding: 32px 16px;
    display: flex;
    flex-direction: column;
    gap: 32px;
  }

  .nav-section {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .nav-heading {
    margin: 0;
    padding: 0 16px;
    font-size: 13px;
    font-weight: 500;
    color: var(--docs-text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .nav-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 16px;
    border-radius: var(--docs-radius-full); /* High pill radius */
    color: var(--docs-text-secondary);
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    transition: background-color 0.2s, color 0.2s;
  }

  .nav-icon {
    opacity: 0.7;
  }

  .nav-item:hover {
    color: var(--docs-text-primary);
    background-color: rgba(255, 255, 255, 0.05);
  }

  .nav-item.active {
    color: var(--docs-text-primary);
    background-color: var(--docs-accent-subtle);
  }

  .nav-item.active .nav-icon {
    opacity: 1;
    color: var(--docs-accent-primary);
  }
</style>
