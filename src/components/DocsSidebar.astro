---
import { getCollection } from 'astro:content';

const { docsContent } = Astro.props as { docsContent: any };
const allDocs = await getCollection('docs');

const docsByCategory = allDocs.reduce((acc, doc) => {
  const category = doc.data.category;
  if (!acc[category]) acc[category] = [];
  acc[category].push(doc);
  return acc;
}, {} as Record<string, typeof allDocs>);

Object.values(docsByCategory).forEach((docs) => docs.sort((a, b) => (a.data.order || 0) - (b.data.order || 0)));
const sortedCategories = Object.keys(docsByCategory);
const currentPath = Astro.url.pathname;
---

<aside class="docs-sidebar">
  <nav class="sidebar-nav">
    {sortedCategories.map((category) => (
      <div class="nav-section">
        <h3 class="nav-heading">{category}</h3>
        <ul class="nav-list">
          {docsByCategory[category].map((doc) => (
            <li><a href={`/docs/${doc.slug}`} class:list={["nav-item", { active: currentPath === `/docs/${doc.slug}` }]}>{doc.data.title}</a></li>
          ))}
        </ul>
      </div>
    ))}
  </nav>
</aside>

<style>
.docs-sidebar{width:260px;border-right:1px solid var(--docs-border-color);padding:20px 12px;position:sticky;top:var(--docs-header-height);height:calc(100vh - var(--docs-header-height));overflow:auto}.nav-list{list-style:none;padding:0}.nav-item{display:block;padding:8px 10px;border-radius:8px;text-decoration:none;color:var(--docs-text-secondary)}.nav-item.active,.nav-item:hover{background:var(--docs-accent-subtle);color:var(--docs-text-primary)}@media (max-width:992px){.docs-sidebar{display:none}}
</style>
